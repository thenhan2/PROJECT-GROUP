# Network Mode Configuration
# This file configures the Network Mode Controller for Pack-A-Mal

# Network Mode: "full", "half", or "transparent"
# - full:        Complete isolation, no external traffic (SAFEST)
# - half:        Transparent proxy with selective forwarding (ADVANCED)
# - transparent: Passive observation only, no traffic alteration
#                Inspired by siemens/sparring transparent mode
#                https://github.com/siemens/sparring
network_mode:
  mode: "full"  # Default to Full Mode for safety

  # Full Mode Configuration
  full_mode:
    # Complete Isolation - Block ALL external traffic
    complete_isolation: true
    
    # Capture PCAP for all traffic
    capture_pcap: true
    
    # Service Configuration - Which service handles which protocol
    services:
      dns: "inetsim"
      dns_address: "172.20.0.2:53"
      
      http: "fakenet-ng"
      http_address: "172.20.0.3:80"
      
      https: "fakenet-ng"
      https_address: "172.20.0.3:443"
      
      smtp: "inetsim"
      smtp_address: "172.20.0.2:25"
      
      ftp: "inetsim"
      ftp_address: "172.20.0.2:21"

  # Half Mode Configuration (ADVANCED - Use with caution)
  half_mode:
    # Enabled - Must be explicitly enabled
    # WARNING: This allows selective external internet access
    enabled: false
    
    # Default Action - What to do when no rule matches
    # Options: forward, block, modify, simulate
    default_action: "simulate"
    
    # External Request Timeout
    external_request_timeout: 10s
    
    # Proxy Configuration
    proxy:
      transparent: true
      listen_address: "0.0.0.0:8888"
      dns_interception: true
      ssl_interception: true
      ssl_cert_path: "/certs/proxy-ca.crt"
      ssl_key_path: "/certs/proxy-ca.key"
    
    # Decision Rules File (optional)
    # decision_rules_file: "/config/decision-rules.yaml"
    
    # Domain Whitelist (always forward)
    whitelist:
      - "*.cloudflare.com"
      - "*.akamai.com"
    
    # Domain Blacklist (always block)
    blacklist:
      - "*.malware-c2.com"
      - "*.evil-domain.net"
    
    # Traffic Modifier Configuration
    traffic_modifier:
      enabled: true
      strip_auth_headers: true
      inject_tracking_headers: true
      sandbox_executables: true
      sandbox_dir: "/logs/executables"
      max_response_size: 10485760  # 10MB

  # =========================================================================
  # Transparent Mode Configuration
  # Inspired by siemens/sparring TRANSPARENT mode:
  #   "sparring will NOT alter any transmitted data and only log connections
  #    and try to extract interesting data for supported protocols."
  #
  # Use cases:
  #   - Passive forensic analysis without disrupting malware behavior
  #   - Baseline traffic profiling before applying full/half mode
  #   - Observing C2 communication patterns in a real network environment
  # =========================================================================
  transparent_mode:
    # enabled - Must be explicitly set to true to use this mode
    enabled: false

    # Extract and log protocol payloads (HTTP bodies, SMTP commands, etc.)
    extract_payloads: true

    # Log all TCP/UDP connections with src/dst/protocol info
    log_connections: true

    # Log ICMP traffic (ping, unreachable, etc.)
    log_icmp: true

    # Protocols to perform deep payload extraction on
    # Valid values: http, https, dns, smtp, ftp
    supported_protocols:
      - "http"
      - "https"
      - "dns"
      - "smtp"
      - "ftp"

    # Path for connection tracking log (JSONL format)
    connection_log_file: "/logs/transparent_connections.log"

    # Path for payload extraction log (JSONL format)
    payload_log_file: "/logs/transparent_payloads.log"

    # Maximum payload size to capture per request (bytes)
    # Larger payloads will be truncated and flagged
    max_payload_size: 1048576  # 1MB

  # Logging Configuration
  logging:
    level: "info"  # debug, info, warn, error
    
    # PCAP Capture
    capture_pcap: true
    pcap_file: "/logs/traffic.pcap"
    
    # Request/Response Logging
    log_all_requests: true
    log_responses: true
    
    # Decision Logging (Half Mode)
    log_decisions: true
    decisions_file: "/logs/decisions.log"
    
    # Traffic Modification Logging
    log_modifications: true
    
    # Traffic Log File
    traffic_log_file: "/logs/traffic.log"
